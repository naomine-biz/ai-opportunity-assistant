
# 認証・認可設計方針

本ドキュメントは、営業オポチュニティマネジメント AIアシスタントシステムにおける認証・認可設計の方針を示す。

---

## 🎯 設計概要

本システムでは以下の設計方針とする：

1. **外部公開APIは存在しない**
   - すべてのAPIは社内利用または内部システム用とする。
   - 外部からの直接アクセスはネットワーク制御（VPN, VPC, Firewall）により防御。

2. **Slack Bot経由の利用において、APIレベルでの認証は行わない**
   - Slack Event APIからのリクエストは、Slack署名検証による認証相当をSlack SDKで処理。
   - 追加の認証・アクセストークンチェックは不要。
   - **入力値のバリデーションに注力し、不正操作を防止。**

3. **管理用APIについては、認証機構を将来的に導入可能な構造とする**
   - 初期段階では未実装（内部API運用）
   - 拡張時には以下のいずれかの認証方式を組み込めるように構造を確保する：
     - Basic認証
     - APIキー認証
     - Bearerトークン認証（JWT等）

4. **FastAPIのdependency injectionを用い、各ルーティングに認証依存関数を適用可能な設計とする**
   - 認証追加は既存のルーティングにdecoratorを付与するだけで対応可能とする。
   - 認証未使用時は `pass` の関数を適用し、後から差し替え可能とする。

---

## 🎯 適用範囲

| APIエンドポイント   | 認証有無     | コメント                         |
| ------------------- | ------------ | -------------------------------- |
| /slack/events       | なし         | Slack署名検証をSDK内で対応       |
| /opportunity/*      | なし（初期） | 将来の管理UI/API対応時に認証追加 |
| /activity_log       | なし         | Slack経由操作のみ                |
| /notify/progress    | なし         | 内部API運用                      |
| /opportunity/search | なし（初期） | 管理UI追加時に認証追加対象       |

---

## 🚩 注意事項

- CRUD系APIについては、将来的に管理画面・外部利用ニーズが発生した際に認証追加を検討する。
- 認証方式導入時の対象API・利用範囲は本ドキュメントに追記すること。
- Slack署名検証はSDK実装およびmiddleware設定により担保。

---

## ✅ 設計意図

- 初期リリースでは **必要最小限の認証** に留め、開発コストを抑制。
- Slackからの操作は **Slack署名検証によるトークンバリデーションのみ** とし、ユーザー認証・権限制御はSlack側の認証結果を利用。
- CRUD系APIは **後から認証追加可能な構造（FastAPI dependency injection前提）** に設計。
- 内部APIについては **ネットワーク境界での防御を基本** とする。

---

以上
