# feature/sqlite-integration-test-setup ブランチのタスクリスト

## 1. SQLiteテスト用データベース設定

- [ ] **テスト用SQLiteデータベース接続設定**
  - [ ] テスト専用のSQLiteデータベース接続文字列設定
  - [ ] インメモリSQLiteオプションの実装（`sqlite:///:memory:`）
  - [ ] 一時ファイルベースのSQLiteオプション実装（`sqlite:///./test.db`）

- [ ] **テスト用データベースマイグレーション設定**
  - [ ] SQLModelのメタデータを使ったテスト用スキーマ作成
  - [ ] テスト前自動作成と後自動クリーンアップ機能
  - [ ] テスト間のデータ分離設定

## 2. テストフィクスチャとファクトリー

- [ ] **共通テストフィクスチャの実装**
  - [ ] SQLiteセッションフィクスチャ
  - [ ] テストトランザクション管理（自動ロールバック）
  - [ ] テスト用依存性注入のオーバーライド設定

- [ ] **テストデータファクトリーの実装**
  - [ ] ユーザーデータ生成ファクトリー
  - [ ] オポチュニティデータ生成ファクトリー
  - [ ] アクティビティログ生成ファクトリー
  - [ ] 各種関連データ生成ユーティリティ

## 3. conftest.pyの拡張

- [ ] **現在のモックベースのフィクスチャをリファクタリング**
  - [ ] クライアントフィクスチャの拡張
  - [ ] 既存モックとの切り替え機能

- [ ] **環境変数とテスト設定の拡張**
  - [ ] テスト環境検出と自動設定
  - [ ] CI環境とローカル環境での分岐設定

- [ ] **テストヘルパー機能の実装**
  - [ ] データベース状態検証ユーティリティ
  - [ ] トランザクション分離ヘルパー

## 4. API統合テスト拡張

- [ ] **実SQLiteを使った統合テスト実装**
  - [ ] notification_routesの統合テスト実装
  - [ ] opportunity_routesの統合テスト実装
  - [ ] activity_routesの統合テスト実装
  - [ ] slack_routesの統合テスト実装

- [ ] **エンドツーエンドテストシナリオの実装**
  - [ ] データ作成→取得→更新→削除の一連フロー検証
  - [ ] エラーパスの統合テスト

## 5. ユーティリティとヘルパー機能

- [ ] **テスト実行時DB状態比較機能**
  - [ ] テスト前後の状態比較ユーティリティ
  - [ ] テスト実行中のデータ検証機能

- [ ] **SQLiteデバッグ支援機能**
  - [ ] テストSQL実行ログ機能
  - [ ] SQLiteデータダンプツール

## 6. ドキュメントと環境整備

- [ ] **テスト環境のREADME拡張**
  - [ ] SQLite統合テスト実行手順ドキュメント
  - [ ] テストデータファクトリー利用ガイド

- [ ] **CI/CD設定の拡張**
  - [ ] GitHub Actions向けSQLiteテスト実行設定
  - [ ] テストカバレッジ計測との連携

## 7. 既存テストとの共存設定

- [ ] **テスト実行モードの切り替え機能**
  - [ ] 環境変数による切り替え設定
  - [ ] pytest実行オプションによる切り替え設定

- [ ] **既存モックテストのリファクタリング**
  - [ ] 重複テストコードの整理
  - [ ] テストパターン別の分離
